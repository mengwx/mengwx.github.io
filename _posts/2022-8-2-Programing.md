---
layout: post
title:  "华为C/C++编码规范"      
category: notes
author: "孟文霞"

---


[转载：华为C/C++编码规范](https://blog.51cto.com/u_15127700/4198270)


### 排版

* 程序块要采用缩进风格编写, 缩进的空格数为4个。
	- 说明: 对于由开发工具自动生成的代码可以有不一致。
* 相对独立的程序块之间、变量说明之后必须加空行。
* 循环、判断等语句中若有较长的表达式或语句, 则要进行适应的划分, 长表达式要在低优先级操作符处划分新行, 操作符放在新行之首。
* 若函数或过程中的参数较长, 则要进行适当的划分。
* 不允许把多个短语句写在一行中, 即一行只写一条语句。
* if、for、do、while、case、switch、default等语句自占一行, 且if、for、do、while等语句的执行语句部分无论多少都要加括号{}。
* 对齐只使用空格键, 不使用TAB键。
* 函数或过程的开始、结构的定义及循环、判断等语句中的代码都要采用缩进风格, case 语句下的情况处理语句也要遵从语句缩进要求。
* 程序块的分界符(如C/C++ 语言的大括号‘{’ 和‘}’ )应各独占一行并且位于同一列, 同时与引用它们的语句左对齐。在函数体的开始、类的定义、结构的定义、枚举的定义以及if、for、do、while、switch、case 语句中的程序都要采用如上的缩进方式。
* 在两个以上的关键字、变量、常量进行对等操作时, 它们之间的操作符之前、之后或者前后要加空格; 进行非对等操作时, 如果是关系密切的立即操作符(如->), 后不应加空格。
	-说明: 采用这种松散方式编写代码的目的是使代码更加清晰。

#### 注意：
1. 由于留空格所产生的清晰性是相对的, 所以, 在已经非常清晰的语句中没有必要再留空格, 如果语句已足够清晰则括号内侧(即左括号后面和右括号前面)不需要加空格, 多重括号间不必加空格, 因为在C/C++语言中括号已经是最清晰的标志了。
2. 在长语句中, 如果需要加的空格非常多, 那么应该保持整体清晰, 而在局部不加空格。给操作符留空格时不要连续留两个以上空格。



 

### 注释

 

* 一般情况下, 源程序有效注释量必须在20％以上。（说明: 注释的原则是有助于对程序的阅读理解, 在该加的地方都加了, 注释不宜太多也不能太少, 注释语言必须准确、易懂、简洁。）
* 说明性文件(如头文件.h 文件、.inc 文件、.def 文件、编译说明文件.cfg 等)头部应进行注释, 注释必须列出: 版权说明、版本号、生成日期、作者、内容、功能、与其它文件的关系、修改日志等, 头文件的注释中还应有函数功能简要说明。
* 源文件头部应进行注释, 列出: 版权说明、版本号、生成日期、作者、模块目的/功能、主要函数及其功能、修改日志等。
* 函数头部应进行注释, 列出: 函数的目的/ 功能、输入参数、输出参数、返回值、调用关系(函数、表)等。示例: 下面这段函数的注释比较标准, 当然, 并不局限于此格式, 但上述信息建议要包含在内。

``` C
Function: // 函数名称
Description: // 函数功能、性能等的描述
Calls: // 被本函数调用的函数清单
Called By: // 调用本函数的函数清单
Table Accessed: // 被访问的表(此项仅对于牵扯到数据库操作的程序)
Table Updated: // 被修改的表(此项仅对于牵扯到数据库操作的程序)
Input: // 输入参数说明, 包括每个参数的作用、取值说明及参数间关系
Output: // 对输出参数的说明
Return: // 函数返回值的说明
```

* 边写代码边注释, 修改代码同时修改相应的注释, 以保证注释与代码的一致性。不再有用的注释要删除。
* 注释的内容要清楚、明了, 含义准确, 防止注释二义性。
* 避免在注释中使用缩写, 特别是非常用缩写
* 注释应与其描述的代码相近, 对代码的注释应放在其上方或右方(对单条语句的注释)相邻位置, 不可放在下面, 如放于上方则需与其上面的代码用空行隔开。
* 对于所有有物理含义的变量、常量, 如果其命名不是充分自注释的, 在声明时都必须加以注释, 说明其物理含义。变量、常量、宏的注释应放在其上方相邻位置或右方。
* 数组、结构、类、枚举等) , 如果其命名不是充分自注释的, 必须加以注释。对数据结构的注释应放在其上方相邻位置, 不可放在下面; 对结构中的每个域的注释放在此域的右方。
* 全局变量要有较详细的注释, 包括对其功能、取值范围、哪些函数或过程存取它以及存取时注意事项等的说明。
* 注释与所描述内容进行同样的缩排。
* 将注释与其上面的代码用空行隔开。
* 函数的头部应进行注释，列出函数的功能、目的、输入输出参数、返回值、调用关系（表、函数）等
* 对变量的定义和分支语句(条件分支、循环语句等)必须编写注释。
* 对于switch语句下的case语句, 如果因为特殊情况需要处理完一个case后进入下一个case处理, 必须在该case语句处理完、下一个case语句前加上明确的注释。

 

### 标识符命名
* 标识符的命名要清晰、明了, 有明确含义, 同时使用完整的单词或大家基本可以理解的缩写, 避免使人产生误解。（说明: 较短的单词可通过去掉“元音”形成缩写; 较长的单词可取单词的头几个字母形成缩写; 一些单词有大家公认的缩写。）示例: 如下单词的缩写能够被大家基本认可。
	1. temp可缩写为 tmp; 临时
	2. flag可缩写为 flg; 标志
	3. statistic可缩写为 stat ; 统计
	4. increment可缩写为 inc; 增量
message可缩写为 msg; 消息
* 命名中若使用特殊约定或缩写, 则要有注释说明。（说明: 应该在源文件的开始之处, 对文件中所使用的缩写或约定, 特别是特殊的缩写, 进行必要的注释说明。）
* 自己特有的命名风格, 要自始至终保持一致, 不可来回变化。（说明: 个人的命名风格, 在符合所在项目组或产品组的命名规则的前提下, 才可使用。即命名规则中没有规定到的地方才可有个人命名风格。）
* 对于变量命名, 禁止取单个字符(如i、j、k… ), 建议除了要有具体含义外, 还能表明其变量类型、数据类型等, 但i、j、k 作局部循环变量是允许的。
说明: 变量, 尤其是局部变量, 如果用单个字符表示, 很容易敲错(如i写成j), 而编译时又检查不出来, 有可能为了这个小小的错误而花费大量的查错时间。
* 命名规范必须与所使用的系统风格保持一致, 并在同一项目中统一, 比如采用UNIX的全小写加下划线的风格或大小写混排的方式, 不要使用大小写与下划线混排的方式, 用作特殊标识如标识成员变量或全局变量的m_ 和g_ , 其后加上大小写混排的方式是允许的

### 可读性
* 注意运算符的优先级，并用括号明确表达式的操作顺序，避免使用默认优先级。
* 避免使用不易理解的数字, 用有意义的标识来替代。涉及物理状态或者含有物理意义的常量, 不应直接使用数字, 必须用有意义的枚举或宏来代替。

### 变量、结构
* 去掉没必要的公共变量。
说明: 公共变量是增大模块间耦合的原因之一, 故应减少没必要的公共变量以降低模块间的耦合度。
* 仔细定义并明确公共变量的含义、作用、取值范围及公共变量间的关系。
说明: 在对变量声明的同时, 应对其含义、作用及取值范围进行注释说明, 同时若有必要还应说明与其它变量的关系。
* 明确公共变量与操作此公共变量的函数或过程的关系, 如访问、修改及创建等。
说明: 明确过程操作变量的关系后, 将有利于程序的进一步优化、单元测试、系统联调以及代码维护等。这种关系的说明可在注释或文档中描述。示例: 在源文件中, 可按如下注释形式说明。
``` C
RELATION System_Init Input_Rec Print_Rec Stat_Score
Student Create Modify Access Access
Score Create Modify Access Access, Modify
```
1. 注: RELATION为操作关系; System_Init、Input_Rec、Print_Rec、Stat_Score为四个不同的函数; Student、Score为两个全局变量; Create表示创建, Modify表示修改, Access表示访问。
2. 其中, 函数Input_Rec、Stat_Score都可修改变量Score, 故此变量将引起函数间较大的耦合, 并可能增加代码测试、维护的难度。

* 当向公共变量传递数据时, 要十分小心, 防止赋与不合理的值或越界等现象发生。
说明: 对公共变量赋值时, 若有必要应进行合法性检查, 以提高代码的可靠性、稳定性。
* 防止局部变量与公共变量同名。
说明: 若使用了较好的命名规则, 那么此问题可自动消除。
* 严禁使用未经初始化的变量作为右值。
说明: 特别是在C/C++中引用未经赋值的指针, 经常会引起系统崩溃。

 

### 函数、过程
* 对所调用函数的错误返回码要仔细、全面地处理
* 明确函数功能, 精确(而不是近似)地实现函数设计
* 编写可重入函数时, 应注意局部变量的使用(如编写C/C++ 语言的可重入函数时, 应使用auto 即缺省态局部变量或寄存器变量)
说明: 编写C/C++语言的可重入函数时, 不应使用static局部变量, 否则必须经过特殊处理, 才能使函数具有可重入性。
* 编写可重入函数时, 若使用全局变量, 则应通过关中断、信号量(即P、V 操作)等手段对其加以保护。
1. 说明: 若对所使用的全局变量不加以保护, 则此函数就不具有可重入性, 即当多个进程调用此函数时, 很有可能使有关全局变量变为不可知状态。
2. 示例: 假设Exam是int型全局变量, 函数Squre_Exam返回Exam平方值。那么如下函数不具有可重入性。
``` C
unsigned int example( int para )
{
unsigned int temp;
Exam = para; // ()
temp = Square_Exam( );
return temp;
}
```

3. 此函数若被多个进程调用的话, 其结果可能是未知的, 因为当()语句刚执行完后, 另外一个使用本函数的进程可能正好被激活, 那么当新激活的进程执行到此函数时, 将使Exam赋与另一个不同的para值, 所以当控制重新回到“temp = Square_Exam( )”后, 计算出的temp很可能不是预想中的结果。此函数应如下改进。

 

``` C
unsigned int example( int para )
{
unsigned int temp;[申请信号量操作] // 若申请不到“信号量”, 说明另外的进程正处于
Exam = para; // 给Exam赋值并计算其平方过程中(即正在使用此信号), 本进程必须等待其释放信号后, 才可继续执行。若申请到信号, 则可继续执行, 但其它进程必须等待本进程释放信号量后, 才能再使用本信号。
temp = Square_Exam( ); // [释放信号量操作]
return temp;
}
```
* 在同一项目组应明确规定对接口函数参数的合法性检查应由函数的调用者负责还是由接口函数本身负责, 缺省是由函数调用者负责。说明: 对于模块间接口函数的参数的合法性检查这一问题, 往往有两个极端现象, 即: 要么是调用者和被调用者对参数均不作合法性检查, 结果就遗漏了合法性检查这一必要的处理过程, 造成问题隐患; 要么就是调用者和被调用者均对参数进行合法性检查, 这种情况虽不会造成问题, 但产生了冗余代码, 降低了效率。

 
### 程序效率
* 编程时要经常注意代码的效率
* 在保证软件系统的正确性、可读性、稳定性及可测试性的前提下，提高代码效率
* 对模块中函数的划分及组织方式进行分析、优化, 改进模块中函数的组织结构, 提高程序效率
* 编程时, 要随时留心代码效率; 优化代码时, 要考虑周全
* 不应花过多的时间拼命地提高调用不很频繁的函数代码效率
* 要仔细地构造或直接用汇编编写调用频繁或性能要求极高的函数
* 在保证程序质量的前提下, 通过压缩代码量、去掉不必要代码以及减少不必要的局部和全局变量, 来提高空间效率
* 在多重循环中, 应将最忙的循环放在最内层
* 尽量减少循环嵌套层次
* 避免循环体内含判断语句, 应将循环语句置于判断语句的代码块之中
* 尽量用乘法或其他的方法代替除法，特别是浮点运算中的除法
* 不要一味追求紧凑的代码
